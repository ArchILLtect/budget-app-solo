import{d as h,u as a,k as U,j as t,M as W,l as z,p as G,q as N,r as O,s as H,t as J,v as K,B as b}from"./index-xwMjE7XY.js";import{r as i}from"./recharts-fUgtte1b.js";import{a as Q}from"./accountUtils-C7DJjkh9.js";import{M as V}from"./modal-close-button-V6F9r3JT.js";import{R as X,a as f}from"./radio-BNrj3pDp.js";import{C as Z}from"./checkbox-BpOi7ikZ.js";import{I as _}from"./input-QV5FdPZP.js";import"./visually-hidden.style-Bfr07Aua.js";import"./use-form-control-B6IaQYr4.js";import"./split-CzYrjwZo.js";import"./omit-QLD0Eizt.js";const ee=()=>new Promise(g=>{(window.requestIdleCallback||(s=>setTimeout(()=>s({didTimeout:!1,timeRemaining:()=>0}),50)))(()=>{requestAnimationFrame(()=>g())})});function ue({isOpen:g,onClose:l,acct:s,months:d}){const[v,x]=i.useState(!1),[c,T]=i.useState("month"),[u,C]=i.useState(!1),[y,k]=i.useState(()=>h().format("YYYY-MM-DD")),M=a(e=>e.setIsLoading),Y=a(e=>e.openLoading),F=a(e=>e.closeLoading),o=a(e=>e.selectedMonth),p=h(o).year().toString(),I=(o||"").slice(0,4),S=s.transactions.filter(e=>e.date?.startsWith(o)),j=s.transactions.filter(e=>e.date?.startsWith(p)),L=d?.filter(e=>e.startsWith(I))||[],{openProgress:w,updateProgress:P,closeProgress:D}=a.getState(),q=a(e=>e.markTransactionsBudgetApplied),E=a(e=>e.processPendingSavingsForAccount),A=U(),R=async()=>{x(!0),M(!0),Y("Finalizing changes..."),await new Promise(requestAnimationFrame);let e=[],n={e:0,i:0,s:0};try{c==="month"&&o?e=[o]:c==="year"?e=L:c==="all"&&(e=d||[]),w("Applying Transactions",e.length);let r=0;for(const $ of e){const m=await Q($,s,!1,u?y:null);n.e+=m.e,n.i+=m.i,n.s+=m.s,r++,P(r),await new Promise(requestAnimationFrame)}const B=e;q(s.accountNumber||s.account||s.label,B),E(s.accountNumber||s.account||s.label,B)}catch(r){A({title:"Error applying budget",description:r.message||r,status:"error",duration:4e3})}finally{x(!1),D(),l(),await ee(),i.startTransition(()=>{M(!1),A({title:"Budget updated",description:`Applied ${e.length} month(s): ${n.e} expenses, ${n.i} income, ${n.s} savings.`,status:"success",duration:4e3}),F()})}};return t.jsxs(W,{isOpen:g,onClose:l,isCentered:!0,children:[t.jsx(z,{}),t.jsxs(G,{children:[t.jsx(N,{children:"Apply to Budget"}),t.jsx(V,{}),t.jsxs(O,{children:[t.jsx(X,{value:c,onChange:T,children:t.jsxs(H,{spacing:3,children:[t.jsx(J,{color:"GrayText",fontSize:"sm",children:"Make sure you have selected desired month or year before proceeding"}),t.jsxs(f,{value:"month",isDisabled:!o||S?.length<=0,children:["Current Month (",h(o).format("MMMM YYYY")||"n/a",") = (",S?.length.toLocaleString("en-US"),")"]}),t.jsxs(f,{value:"year",isDisabled:!p||j.length<=0,children:["Current Year (",p||"year not set",") = (",j?.length.toLocaleString("en-US")||0,")"]}),t.jsxs(f,{value:"all",isDisabled:!d||d?.length<=0,children:["All Transactions (",s?.transactions?.length.toLocaleString("en-US")||0,")"]})]})}),t.jsx("hr",{style:{marginTop:"15px",marginBottom:"15px"}}),t.jsx(Z,{isChecked:u,onChange:e=>C(e.target.checked),children:"Ignore all savings goal linking before this date"}),u&&t.jsx(_,{type:"date",value:y,onChange:e=>k(e.target.value),mt:2})]}),t.jsxs(K,{children:[t.jsx(b,{variant:"ghost",onClick:l,mr:3,children:"Cancel"}),t.jsx(b,{colorScheme:"teal",onClick:R,isLoading:v,children:"Apply"})]})]})]})}export{ue as default};
