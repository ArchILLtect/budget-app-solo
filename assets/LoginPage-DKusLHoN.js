import{d as I,k as E,a0 as M,u as x,j as e,i as B,H as W,F as Y,V as z,B as S,t as v,a1 as H,a2 as _,a3 as L,a4 as D,a5 as q}from"./index-xwMjE7XY.js";import{r as m}from"./recharts-fUgtte1b.js";import{L as V}from"./LoadingSpinner-BAAFQNyv.js";import{F as C}from"./use-form-control-B6IaQYr4.js";import{F as b}from"./form-label-Cqg8IcOd.js";import{I as k}from"./input-QV5FdPZP.js";import{C as G}from"./checkbox-BpOi7ikZ.js";import"./center-CIAJU8Ix.js";import"./visually-hidden.style-Bfr07Aua.js";import"./omit-QLD0Eizt.js";let h=(i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((r,s)=>(s&=63,s<36?r+=s.toString(36):s<62?r+=(s-26).toString(36).toUpperCase():s>62?r+="-":r+="_",r),"");function $(i){const s=I().format("YYYY-MM"),c={id:h(),name:"Demo Checking",source:"csv",importedAt:new Date().toISOString(),transactions:[{id:h(),date:s+"-05",description:"Coffee Shop",amount:-4.75,type:"expense",category:"Food & Drink"},{id:h(),date:s+"-10",description:"Freelance Project",amount:1200,type:"income",category:"Work"},{id:h(),date:s+"-15",description:"Transfer to Savings",amount:-300,type:"savings",category:"Transfer"}]};i(()=>({selectedMonth:s,syncedAccounts:[c],savingsGoals:[{id:"yearly",name:"Yearly Savings Goal",amount:1e4}]}))}const N="https://xuvfgfgsm5.execute-api.us-east-2.amazonaws.com/dev";function ae(){const[i,r]=m.useState(!1),[s,c]=m.useState(!1),P=m.useRef(null),[f,R]=m.useState({username:"",password:""}),u=E(),p=M(),g=x(t=>t.setUser),y=x(t=>t.setIsDemoUser);m.useEffect(()=>{(async()=>{const n=await _();n&&(g(n),p("/planner"))})()},[p,g]);const j=t=>{const{name:n,value:o}=t.target;R(a=>({...a,[n]:o}))};async function U(t,n=3,o=500){for(let a=0;a<n;a++)try{return(await q.post(`${N}/login2`,{...f,ip:t})).data}catch(d){if(!(d.response?.status===502)||a===n-1)throw d;u({title:`Login attempt ${a+1} failed. Retrying...`,description:"AWS may be waking up. Please wait...",status:"warning",duration:3e3,isClosable:!0}),await new Promise(w=>setTimeout(w,o))}}const A=async t=>{t.preventDefault(),c(!0);const n=Date.now();try{const o=await fetch("https://api.ipify.org?format=json"),{ip:a}=await o.json(),{jwt:d,user:l}=await U(a);L(d,l),g(l),window.opener&&(window.opener.postMessage({type:"loginSuccess"},window.location.origin),window.close()),u({title:"Logged in!",status:"success",duration:2e3});const w=l?.role?D[l.role]??0:0;p((w>=D.admin,"/planner"))}catch(o){u({title:o.response?.data?.message||"Login failed",status:"error",duration:3e3}),console.error("Login failed:",o)}finally{const o=Date.now()-n,a=Math.max(0,500-o);y(!1),setTimeout(()=>c(!1),a)}},F=()=>{c(!0),setTimeout(()=>{const t={id:"demo",username:"demo",role:"user",email:"sample@email.com"};L("demo-token",t),g(t),$(x.setState),y(!0),u({title:"Logged in as demo user",status:"success",duration:2e3}),p("/planner"),c(!1)},800)},T=()=>{r(t=>!t)};return e.jsxs(B,{maxW:"md",mx:"auto",mt:20,p:6,borderWidth:1,borderRadius:"lg",bg:"white",shadow:"md",children:[e.jsx(W,{size:"lg",mb:4,textAlign:"center",color:"gray.700",children:"Login"}),s?e.jsx(Y,{pos:"fixed",top:0,left:0,w:"100vw",h:"100vh",zIndex:"modal",bg:"rgba(0,0,0,0.4)",justify:"center",align:"center",children:e.jsx(V,{})}):e.jsxs(z,{spacing:4,align:"stretch",as:"form",onSubmit:A,children:[e.jsxs(C,{children:[e.jsx(b,{children:"Username"}),e.jsx(k,{name:"username",value:f.username,onChange:j,placeholder:"Enter username",isRequired:!0})]}),e.jsxs(C,{children:[e.jsx(b,{children:"Password"}),e.jsx(k,{id:"password",ref:P,name:"password",type:i?"text":"password",value:f.password,onChange:j,placeholder:"Enter password",isRequired:!0}),e.jsx(G,{id:"show-password",mt:2,isChecked:i,onChange:T,colorScheme:"blue",children:i?"Hide Password":"Show Password"})]}),e.jsx(S,{type:"submit",colorScheme:"blue",isDisabled:s,children:"Login"}),e.jsx(S,{onClick:F,mt:2,colorScheme:"green",isDisabled:s,children:"Try Demo Mode"})]}),e.jsxs(v,{mt:4,textAlign:"center",fontSize:"sm",color:"gray.600",children:["Donâ€™t have an account?"," ",e.jsx(H,{to:"/register",children:e.jsx(v,{as:"span",color:"blue.500",fontWeight:"semibold",_hover:{textDecoration:"underline"},children:"Register here"})})]})]})}export{ae as default};
