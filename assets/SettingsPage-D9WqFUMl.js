import{z as O,j as t,L as Fe,a9 as $e,a8 as qe,Z as ie,J as j,Y as ue,f as K,x as Xe,o as Ye,X as Be,c as G,a as _e,u as M,k as Je,i as ce,H as Te,F as Ze,t as P,V as Qe,K as et,B as te}from"./index-xwMjE7XY.js";import{r as i}from"./recharts-fUgtte1b.js";import{B as ne}from"./badge-f7PBaRE6.js";import{c as tt,F as U}from"./use-form-control-B6IaQYr4.js";import{F as V}from"./form-label-Cqg8IcOd.js";import{u as nt}from"./use-event-listener-BvnzY9DD.js";function st(n){const s=parseFloat(n);return typeof s!="number"||Number.isNaN(s)?0:s}function Re(n,s){let o=st(n);const a=10**(s??10);return o=Math.round(o*a)/a,s?o.toFixed(s):o.toString()}function ke(n){if(!Number.isFinite(n))return 0;let s=1,o=0;for(;Math.round(n*s)/s!==n;)s*=10,o+=1;return o}function rt(n,s,o){return n==null?n:(o<s&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,s),o))}function ot(n={}){const{onChange:s,precision:o,defaultValue:a,value:l,step:u=1,min:m=Number.MIN_SAFE_INTEGER,max:h=Number.MAX_SAFE_INTEGER,keepWithinRange:p=!0}=n,A=O(s),[d,I]=i.useState(()=>a==null?"":le(a,u,o)??""),b=typeof l<"u",S=b?l:d,F=Oe(H(S),u),D=o??F,C=i.useCallback(f=>{f!==S&&(b||I(f.toString()),A?.(f.toString(),H(f)))},[A,b,S]),r=i.useCallback(f=>{let g=f;return p&&(g=rt(g,m,h)),Re(g,D)},[D,p,h,m]),x=i.useCallback((f=u)=>{let g;S===""?g=H(f):g=H(S)+f,g=r(g),C(g)},[r,u,C,S]),T=i.useCallback((f=u)=>{let g;S===""?g=H(-f):g=H(S)-f,g=r(g),C(g)},[r,u,C,S]),E=i.useCallback(()=>{let f;a==null?f="":f=le(a,u,o)??m,C(f)},[a,o,u,C,m]),re=i.useCallback(f=>{const g=le(f,u,D)??m;C(g)},[D,u,C,m]),B=H(S);return{isOutOfRange:B>h||B<m,isAtMax:B===h,isAtMin:B===m,precision:D,value:S,valueAsNumber:B,update:C,reset:E,increment:x,decrement:T,clamp:r,cast:re,setValue:I}}function H(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function Oe(n,s){return Math.max(ke(s),ke(n))}function le(n,s,o){const a=H(n);if(Number.isNaN(a))return;const l=Oe(a,s);return Re(a,o??l)}function at(n,s){const o=O(n);i.useEffect(()=>{let a=null;const l=()=>o();return s!==null&&(a=window.setInterval(l,s)),()=>{a&&window.clearInterval(a)}},[s,o])}const it=n=>t.jsx(Fe,{viewBox:"0 0 24 24",...n,children:t.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),ut=n=>t.jsx(Fe,{viewBox:"0 0 24 24",...n,children:t.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function Pe(n,s,o,a){i.useEffect(()=>{if(!n.current||!a)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(s)?s:[s],m=new l.MutationObserver(h=>{for(const p of h)p.type==="attributes"&&p.attributeName&&u.includes(p.attributeName)&&o(p)});return m.observe(n.current,{attributes:!0,attributeFilter:u}),()=>m.disconnect()})}const ct=50,He=300;function lt(n,s){const[o,a]=i.useState(!1),[l,u]=i.useState(null),[m,h]=i.useState(!0),p=i.useRef(null),A=()=>clearTimeout(p.current);at(()=>{l==="increment"&&n(),l==="decrement"&&s()},o?ct:null);const d=i.useCallback(()=>{m&&n(),p.current=setTimeout(()=>{h(!1),a(!0),u("increment")},He)},[n,m]),I=i.useCallback(()=>{m&&s(),p.current=setTimeout(()=>{h(!1),a(!0),u("decrement")},He)},[s,m]),b=i.useCallback(()=>{h(!0),a(!1),A()},[]);return i.useEffect(()=>()=>A(),[]),{up:d,down:I,stop:b,isSpinning:o}}const dt=/^[Ee0-9+\-.]$/;function mt(n){return dt.test(n)}function pt(n,s){if(n.key==null)return!0;const o=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||o?!0:s(n.key)}function ht(n={}){const{focusInputOnChange:s=!0,clampValueOnBlur:o=!0,keepWithinRange:a=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:m=1,isReadOnly:h,isDisabled:p,isRequired:A,isInvalid:d,pattern:I="[0-9]*(.[0-9]+)?",inputMode:b="decimal",allowMouseWheel:S,id:F,onChange:D,precision:C,name:r,"aria-describedby":x,"aria-label":T,"aria-labelledby":E,onFocus:re,onBlur:B,onInvalid:me,getAriaValueText:pe,isValidCharacter:he,format:f,parse:g,...Ve}=n,xe=O(re),fe=O(B),oe=O(me),$=O(he??mt),ge=O(pe),c=ot(n),{update:W,increment:ye,decrement:be}=c,[We,ae]=i.useState(!1),q=!(h||p),k=i.useRef(null),X=i.useRef(null),Se=i.useRef(null),Ae=i.useRef(null),Y=i.useCallback(e=>e.split("").filter($).join(""),[$]),J=i.useCallback(e=>g?.(e)??e,[g]),L=i.useCallback(e=>(f?.(e)??e).toString(),[f]);$e(()=>{(c.valueAsNumber>u||c.valueAsNumber<l)&&oe?.("rangeOverflow",L(c.value),c.valueAsNumber)},[c.valueAsNumber,c.value,L,oe]),qe(()=>{if(!k.current)return;if(k.current.value!=c.value){const y=J(k.current.value);c.setValue(Y(y))}},[J,Y]);const Z=i.useCallback((e=m)=>{q&&ye(e)},[ye,q,m]),Q=i.useCallback((e=m)=>{q&&be(e)},[be,q,m]),N=lt(Z,Q);Pe(Se,"disabled",N.stop,N.isSpinning),Pe(Ae,"disabled",N.stop,N.isSpinning);const Ne=i.useCallback(e=>{if(e.nativeEvent.isComposing)return;const v=J(e.currentTarget.value);W(Y(v)),X.current={start:e.currentTarget.selectionStart,end:e.currentTarget.selectionEnd}},[W,Y,J]),ve=i.useCallback(e=>{xe?.(e),X.current&&(e.currentTarget.selectionStart=X.current.start??e.currentTarget.value?.length,e.currentTarget.selectionEnd=X.current.end??e.currentTarget.selectionStart)},[xe]),Ce=i.useCallback(e=>{if(e.nativeEvent.isComposing)return;pt(e,$)||e.preventDefault();const y=Ie(e)*m,v=e.key,z={ArrowUp:()=>Z(y),ArrowDown:()=>Q(y),Home:()=>W(l),End:()=>W(u)}[v];z&&(e.preventDefault(),z(e))},[$,m,Z,Q,W,l,u]),Ie=e=>{let y=1;return(e.metaKey||e.ctrlKey)&&(y=.1),e.shiftKey&&(y=10),y},Me=i.useMemo(()=>{const e=ge?.(c.value);if(e!=null)return e;const y=c.value.toString();return y||void 0},[c.value,ge]),je=i.useCallback(()=>{let e=c.value;if(c.value==="")return;/^[eE]/.test(c.value.toString())?c.setValue(""):(c.valueAsNumber<l&&(e=l),c.valueAsNumber>u&&(e=u),c.cast(e))},[c,u,l]),Ee=i.useCallback(()=>{ae(!1),o&&je()},[o,ae,je]),ee=i.useCallback(()=>{s&&requestAnimationFrame(()=>{k.current?.focus()})},[s]),we=i.useCallback(e=>{e.preventDefault(),N.up(),ee()},[ee,N]),De=i.useCallback(e=>{e.preventDefault(),N.down(),ee()},[ee,N]);nt(()=>k.current,"wheel",e=>{const v=(k.current?.ownerDocument??document).activeElement===k.current;if(!S||!v)return;e.preventDefault();const w=Ie(e)*m,z=Math.sign(e.deltaY);z===-1?Z(w):z===1&&Q(w)},{passive:!1});const ze=i.useCallback((e={},y=null)=>{const v=p||a&&c.isAtMax;return{...e,ref:ue(y,Se),role:"button",tabIndex:-1,onPointerDown:j(e.onPointerDown,w=>{w.button!==0||v||we(w)}),onPointerLeave:j(e.onPointerLeave,N.stop),onPointerUp:j(e.onPointerUp,N.stop),disabled:v,"aria-disabled":ie(v)}},[c.isAtMax,a,we,N.stop,p]),Ke=i.useCallback((e={},y=null)=>{const v=p||a&&c.isAtMin;return{...e,ref:ue(y,Ae),role:"button",tabIndex:-1,onPointerDown:j(e.onPointerDown,w=>{w.button!==0||v||De(w)}),onPointerLeave:j(e.onPointerLeave,N.stop),onPointerUp:j(e.onPointerUp,N.stop),disabled:v,"aria-disabled":ie(v)}},[c.isAtMin,a,De,N.stop,p]),Ge=i.useCallback((e={},y=null)=>({name:r,inputMode:b,type:"text",pattern:I,"aria-labelledby":E,"aria-label":T,"aria-describedby":x,id:F,disabled:p,role:"spinbutton",...e,readOnly:e.readOnly??h,"aria-readonly":e.readOnly??h,"aria-required":e.required??A,required:e.required??A,ref:ue(k,y),value:L(c.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(c.valueAsNumber)?void 0:c.valueAsNumber,"aria-invalid":ie(d??c.isOutOfRange),"aria-valuetext":Me,autoComplete:"off",autoCorrect:"off",onChange:j(e.onChange,Ne),onKeyDown:j(e.onKeyDown,Ce),onFocus:j(e.onFocus,ve,()=>ae(!0)),onBlur:j(e.onBlur,fe,Ee)}),[r,b,I,E,T,L,x,F,p,A,h,d,c.value,c.valueAsNumber,c.isOutOfRange,l,u,Me,Ne,Ce,ve,fe,Ee]);return{value:L(c.value),valueAsNumber:c.valueAsNumber,isFocused:We,isDisabled:p,isReadOnly:h,getIncrementButtonProps:ze,getDecrementButtonProps:Ke,getInputProps:Ge,htmlProps:Ve}}const[xt,se]=Be({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[ft,de]=Be({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),_=K(function(s,o){const a=Xe("NumberInput",s),l=Ye(s),u=tt(l),{htmlProps:m,...h}=ht(u),p=i.useMemo(()=>h,[h]);return t.jsx(ft,{value:p,children:t.jsx(xt,{value:a,children:t.jsx(G.div,{...m,ref:o,className:_e("chakra-numberinput",s.className),__css:{position:"relative",zIndex:0,...a.root}})})})});_.displayName="NumberInput";const gt=K(function(s,o){const a=se();return t.jsx(G.div,{"aria-hidden":!0,ref:o,...s,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...a.stepperGroup}})});gt.displayName="NumberInputStepper";const R=K(function(s,o){const{getInputProps:a}=de(),l=a(s,o),u=se();return t.jsx(G.input,{...l,className:_e("chakra-numberinput__field",s.className),__css:{width:"100%",...u.field}})});R.displayName="NumberInputField";const Le=G("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),yt=K(function(s,o){const a=se(),{getDecrementButtonProps:l}=de(),u=l(s,o);return t.jsx(Le,{...u,__css:a.stepper,children:s.children??t.jsx(it,{})})});yt.displayName="NumberDecrementStepper";const bt=K(function(s,o){const{getIncrementButtonProps:a}=de(),l=a(s,o),u=se();return t.jsx(Le,{...l,__css:u.stepper,children:s.children??t.jsx(ut,{})})});bt.displayName="NumberIncrementStepper";const Ue=n=>t.jsx(G.div,{className:"chakra-stack__divider",...n,__css:{...n.__css,borderWidth:0,alignSelf:"stretch",borderColor:"inherit",width:"auto",height:"auto"}});Ue.displayName="StackDivider";function Mt(){const n=M(r=>r.importUndoWindowMinutes),s=M(r=>r.importHistoryMaxEntries),o=M(r=>r.importHistoryMaxAgeDays),a=M(r=>r.stagedAutoExpireDays),l=M(r=>r.streamingAutoLineThreshold),u=M(r=>r.streamingAutoByteThreshold);M(r=>r.showIngestionBenchmark),M(r=>r.setShowIngestionBenchmark);const m=M(r=>r.updateImportSettings),h=M(r=>r.pruneImportHistory),p=M(r=>r.expireOldStagedTransactions),A=Je(),[d,I]=i.useState({importUndoWindowMinutes:n??30,importHistoryMaxEntries:s??30,importHistoryMaxAgeDays:o??30,stagedAutoExpireDays:a??30,streamingAutoLineThreshold:l??3e3,streamingAutoByteThreshold:u??5e5});i.useEffect(()=>{I(r=>{const x={importUndoWindowMinutes:n??r.importUndoWindowMinutes,importHistoryMaxEntries:s??r.importHistoryMaxEntries,importHistoryMaxAgeDays:o??r.importHistoryMaxAgeDays,stagedAutoExpireDays:a??r.stagedAutoExpireDays,streamingAutoLineThreshold:l??r.streamingAutoLineThreshold,streamingAutoByteThreshold:u??r.streamingAutoByteThreshold};return Object.keys(x).every(E=>x[E]===r[E])?r:x})},[n,s,o,a,l,u]);const b=(r,x,T)=>{Number.isNaN(T)||I(E=>({...E,[r]:T}))},S=()=>{if(!F){A({title:"No changes",status:"info",duration:1500});return}m({...d}),(s!==d.importHistoryMaxEntries||o!==d.importHistoryMaxAgeDays)&&h(),a!==d.stagedAutoExpireDays&&p(),A({title:"Settings saved",status:"success",duration:2500})},F=n!==d.importUndoWindowMinutes||s!==d.importHistoryMaxEntries||o!==d.importHistoryMaxAgeDays||a!==d.stagedAutoExpireDays||l!==d.streamingAutoLineThreshold||u!==d.streamingAutoByteThreshold,D=`Keeps up to ${d.importHistoryMaxEntries} sessions for ${d.importHistoryMaxAgeDays} days (whichever is stricter). Staged transactions auto-apply after ${d.stagedAutoExpireDays} day(s). Undo window: ${d.importUndoWindowMinutes} minute(s).`,C=`Auto-stream when > ${d.streamingAutoLineThreshold.toLocaleString()} lines or > ${(d.streamingAutoByteThreshold/1024).toFixed(0)} KB.`;return t.jsxs(ce,{p:6,maxW:"700px",mb:20,children:[t.jsx(Te,{size:"md",mb:4,children:"Import & Staging Settings"}),t.jsxs(ce,{mb:6,p:3,borderWidth:1,borderRadius:"md",bg:"gray.50",children:[t.jsxs(Ze,{wrap:"wrap",gap:2,mb:1,children:[t.jsxs(ne,{colorScheme:"teal",children:["Undo ",d.importUndoWindowMinutes,"m"]}),t.jsxs(ne,{colorScheme:"purple",children:["History ",d.importHistoryMaxEntries," max"]}),t.jsxs(ne,{colorScheme:"purple",children:["History ",d.importHistoryMaxAgeDays,"d age"]}),t.jsxs(ne,{colorScheme:"orange",children:["Auto-expire ",d.stagedAutoExpireDays,"d"]})]}),t.jsx(P,{fontSize:"xs",color:"gray.600",children:D})]}),t.jsxs(Qe,{align:"stretch",spacing:5,divider:t.jsx(Ue,{}),children:[t.jsxs(U,{children:[t.jsx(V,{children:"Undo Window (minutes)"}),t.jsx(_,{min:1,max:720,value:d.importUndoWindowMinutes,onChange:(r,x)=>b("importUndoWindowMinutes",r,x),children:t.jsx(R,{})}),t.jsx(P,{fontSize:"xs",color:"gray.500",children:"How long after import sessions can be undone."})]}),t.jsxs(U,{children:[t.jsx(V,{children:"Streaming Auto Line Threshold"}),t.jsx(_,{min:500,max:2e5,step:100,value:d.streamingAutoLineThreshold,onChange:(r,x)=>b("streamingAutoLineThreshold",r,x),children:t.jsx(R,{})}),t.jsx(P,{fontSize:"xs",color:"gray.500",children:"If a CSV exceeds this many lines, streaming parser auto-enables."})]}),t.jsxs(U,{children:[t.jsx(V,{children:"Streaming Auto Size Threshold (KB)"}),t.jsx(_,{min:50,max:20480,step:50,value:Math.round(d.streamingAutoByteThreshold/1024),onChange:(r,x)=>b("streamingAutoByteThreshold",r,x*1024),children:t.jsx(R,{})}),t.jsx(P,{fontSize:"xs",color:"gray.500",children:"If file size exceeds this value, streaming parser auto-enables."})]}),t.jsxs(U,{children:[t.jsx(V,{children:"Import History Max Entries"}),t.jsx(_,{min:5,max:500,value:d.importHistoryMaxEntries,onChange:(r,x)=>b("importHistoryMaxEntries",r,x),children:t.jsx(R,{})}),t.jsx(P,{fontSize:"xs",color:"gray.500",children:"Newest sessions kept; older pruned beyond this count."})]}),t.jsxs(U,{children:[t.jsx(V,{children:"Import History Max Age (days)"}),t.jsx(_,{min:1,max:365,value:d.importHistoryMaxAgeDays,onChange:(r,x)=>b("importHistoryMaxAgeDays",r,x),children:t.jsx(R,{})}),t.jsx(P,{fontSize:"xs",color:"gray.500",children:"Sessions older than this may be pruned."})]}),t.jsxs(U,{children:[t.jsx(V,{children:"Auto-Expire Staged Sessions (days)"}),t.jsx(_,{min:1,max:120,value:d.stagedAutoExpireDays,onChange:(r,x)=>b("stagedAutoExpireDays",r,x),children:t.jsx(R,{})}),t.jsx(P,{fontSize:"xs",color:"gray.500",children:"Staged transactions auto-applied after this age."})]}),t.jsxs(et,{spacing:3,flexWrap:"wrap",children:[t.jsx(te,{colorScheme:"teal",onClick:S,isDisabled:!F,children:"Save"}),t.jsx(te,{variant:"outline",onClick:()=>I({importUndoWindowMinutes:n??30,importHistoryMaxEntries:s??30,importHistoryMaxAgeDays:o??30,stagedAutoExpireDays:a??30,streamingAutoLineThreshold:l??3e3,streamingAutoByteThreshold:u??5e5}),children:"Reset"}),t.jsx(te,{size:"sm",variant:"ghost",onClick:()=>{h(),A({title:"History pruned",status:"success",duration:1500})},children:"Prune Now"}),t.jsx(te,{size:"sm",variant:"ghost",onClick:()=>{p(),A({title:"Expired staged processed",status:"success",duration:1500})},children:"Force Expire"})]})]}),t.jsxs(ce,{mt:6,p:3,borderWidth:1,borderRadius:"md",bg:"purple.50",children:[t.jsx(Te,{size:"sm",mb:2,children:"Streaming Auto-Toggle"}),t.jsx(P,{fontSize:"xs",color:"gray.700",children:C})]}),!1]})}export{Mt as default};
