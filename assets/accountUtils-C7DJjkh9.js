import"./recharts-fUgtte1b.js";import{u as h,g as w,n as S,d as D,b as E,e as U}from"./index-xwMjE7XY.js";const{toast:O}=E();function L(n,a="shortMonthAndDay"){let e;if(a==="shortMonthAndDay"){const[s,t,r]=n.split("-"),p=new Date(+s,+t-1,+r);e=new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit"}).format(p).replace(",","-")}else if(a==="shortMonth"){const[s,t]=n.split("-"),r=new Date(`${s}-${t}-01T12:00:00`);e=new Intl.DateTimeFormat("en-US",{month:"short"}).format(r)}else if(a==="longMonth"){const[s,t]=n.split("-"),r=new Date(`${s}-${t}-01T12:00:00`);e=new Intl.DateTimeFormat("en-US",{month:"long"}).format(r)}else if(a==="year"){const[s,t]=n.split("-"),r=new Date(`${s}-${t}-01T12:00:00`);e=new Intl.DateTimeFormat("en-US",{year:"numeric"}).format(r)}else a==="monthNumber"&&(e=n.split("-")[1]);return e}function N(n){const a=["prime video","netlify","bluehost","openai","aws","patreon","crunchyroll","walgreens","wal-mart","wal-sams","woodmans","credit one bank","capital petroleum","cenex","grubhub"],e=n.toLowerCase();for(let t of a)if(e.includes(t))return t;const s=e.match(/\d{2}\/\d{2}\/\d{2}/);if(s){const t=e.split(s[0]);if(t[1])return t[1].trim().split(/\s+/).slice(0,3).join(" ")}return e.slice(0,32)}function P(n){const a=new Set;return n.forEach(e=>{e.origin&&a.add(e.origin)}),Array.from(a).sort((e,s)=>e.localeCompare(s))}const B=async(n,a,e=!0,s=null)=>{const t=h.getState();t.monthlyActuals[n]||h.setState(o=>({monthlyActuals:{...o.monthlyActuals,[n]:{actualExpenses:[],actualFixedIncomeSources:[],actualTotalNetIncome:0,customSavings:0}}}));const r=t.monthlyActuals[n]||{},p=r.actualExpenses||[],v=(r.actualFixedIncomeSources||[]).filter(o=>o.id!=="main"),T=t.savingsLogs[n]||[],y=a.transactions.filter(o=>o.date?.startsWith(n));let m=[],d=[],u=[];const I=500;for(let o=0;o<y.length;o+=I){const i=y.slice(o,o+I);m.push(...w(p,i.filter(l=>l.type==="expense"))),d.push(...w(v,i.filter(l=>l.type==="income"))),u.push(...w(T,i.filter(l=>l.type==="savings"),U)),await new Promise(requestAnimationFrame)}const A=[...v,...d],b=A.reduce((o,i)=>o+S(i),0);if(t.updateMonthlyActuals(n,{actualFixedIncomeSources:A,actualTotalNetIncome:b}),m.forEach(o=>t.addActualExpense(n,{...o,amount:S(o)})),u.length>0){let o=u.map(i=>({id:i.id,date:i.date,name:i.name,amount:S(i),month:n}));if(s){const i=D(s),[l,F]=k(o,c=>D(c.date).isBefore(i,"day")),g={};if(l.forEach(c=>{(g[c.month]||=[]).push({goalId:null,date:c.date,amount:c.amount,name:c.name,id:c.id||crypto.randomUUID(),createdAt:c.createdAt||new Date().toISOString()})}),Object.keys(g).length&&h.setState(c=>{const f={...c.savingsLogs};for(const[x,M]of Object.entries(g)){const $=f[x]||[];f[x]=$.concat(M)}return{savingsLogs:f}}),o=F,await new Promise(requestAnimationFrame),o.length===0)return{e:m.length,i:d.length,s:u.length}}t.setSavingsReviewQueue(o),t.setSavingsModalOpen(!0),await new Promise(i=>{h.setState({resolveSavingsPromise:i})})}return e&&O({title:"Budget updated",description:`Applied ${m.length} expenses, ${d.length} income, ${u.length} savings`,status:"success",duration:3e3}),{e:m.length,i:d.length,s:u.length}},k=(n,a)=>n.reduce(([e,s],t)=>a(t)?[[...e,t],s]:[e,[...s,t]],[[],[]]);export{B as a,N as e,L as f,P as g};
