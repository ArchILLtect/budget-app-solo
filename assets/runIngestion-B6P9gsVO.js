const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/__vite-browser-external-3a0vqkmD.js","assets/create-icon-DM1WmCyW.js","assets/index-xwMjE7XY.js","assets/recharts-fUgtte1b.js"])))=>i.map(i=>d[i]);
import{f as X,j as B,c as le,ac as fe,ad as Q,ae as pe,d as j,_ as de,af as x}from"./index-xwMjE7XY.js";import{e as me}from"./accountUtils-C7DJjkh9.js";const W=X(function(n,t){const{templateAreas:r,gap:s,rowGap:c,columnGap:i,column:a,row:u,autoFlow:d,autoRows:l,templateRows:m,autoColumns:h,templateColumns:p,...g}=n,w={display:"grid",gridTemplateAreas:r,gridGap:s,gridRowGap:c,gridColumnGap:i,gridAutoColumns:h,gridColumn:a,gridRow:u,gridAutoFlow:d,gridAutoRows:l,gridTemplateRows:m,gridTemplateColumns:p};return B.jsx(le.div,{ref:t,__css:w,...g})});W.displayName="Grid";const ge=X(function(n,t){const{columns:r,spacingX:s,spacingY:c,spacing:i,minChildWidth:a,...u}=n,d=fe(),l=a?we(a,d):he(r);return B.jsx(W,{ref:t,gap:i,columnGap:s,rowGap:c,templateColumns:l,...u})});ge.displayName="SimpleGrid";function ye(e){return typeof e=="number"?`${e}px`:e}function we(e,n){return Q(e,t=>{const r=pe("sizes",t,ye(t))(n);return t===null?null:`repeat(auto-fit, minmax(${r}, 1fr))`})}function he(e){return Q(e,n=>n===null?null:`repeat(${n}, minmax(0, 1fr))`)}function Se(e){const n=[];if(!e)return{rows:[],errors:n};const t=e.split(/\r?\n/);let r=-1;for(let i=0;i<t.length;i++)if(t[i].trim().length>0){r=i;break}if(r===-1)return{rows:[],errors:n};const s=H(t[r]).map(i=>i.trim()),c=[];for(let i=r+1;i<t.length;i++){const a=t[i];if(a.trim())try{const u=H(a);if(!u.length)continue;const d={};s.forEach((l,m)=>{const h=u[m]??"";d[l]=h.replace(/^"(.*)"$/,"$1")}),d.__line=i+1,c.push(d)}catch(u){n.push({line:i+1,message:u?.message||"Parse failure"})}}return{rows:c,errors:n}}function H(e){const n=[];let t="",r=!1;for(let s=0;s<e.length;s++){const c=e[s];if(c==='"'){if(e[s+1]==='"'){t+='"',s++;continue}r=!r;continue}c===","&&!r?(n.push(t),t=""):t+=c}return n.push(t),n}function Ce(e){if(e==null)return null;let n=String(e).trim();if(!n)return null;let t=1;if(/^\(.*\)$/.test(n)&&(t=-1,n=n.slice(1,-1).trim()),n=n.replace(/[$]/g,"").trim(),/^[+-]/.test(n)&&(n[0]==="-"&&(t=-1),n=n.slice(1).trim()),/[+-]$/.test(n)&&(n.slice(-1)==="-"&&(t=-1),n=n.slice(0,-1).trim()),n=n.replace(/,/g,""),!n||!/^\d+(\.\d+)?$/.test(n)){const s=Number(n);return Number.isFinite(s)?{raw:t*s,abs:Math.abs(t*s)}:null}const r=Number(n);return Number.isFinite(r)?{raw:t*r,abs:Math.abs(t*r)}:null}function _e(e){if(!e)return null;const n=(e.date||e.Date||e["Posted Date"]||"").toString().trim();if(!n)return null;let t=j(n);if(!t.isValid()){const m=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);if(m){let[,h,p,g]=m;g.length===2&&(g=(Number(g)<70?"20":"19")+g),t=j(`${g}-${h.padStart(2,"0")}-${p.padStart(2,"0")}`)}}if(!t.isValid())return null;const r=t.format("YYYY-MM-DD"),s=(e.description||e.Description||e.memo||e.Memo||"").toString().trim();if(!s)return null;const c=e.amount??e.Amount??e.amt??e.Amt??"",i=Ce(c);if(!i)return null;const u=(e.category||e.Category||e.CATEGORY||"").toString().trim()||void 0,d=(e.type||e.Type||"").toString().toLowerCase().trim();let l=["income","expense","savings"].includes(d)?d:null;return{id:crypto.randomUUID(),date:r,description:s,amount:i.abs,rawAmount:i.raw,type:l,category:u,original:e}}function De(e){const n=(e.description||"").toLowerCase();if(e.type==="savings"||n.includes("transfer")||n.includes("tfr ")||n.includes(" save")||n.includes("savings"))return{...e,type:"savings"};const r=(typeof e.rawAmount=="number"?e.rawAmount:Number(e.amount)||0)>=0?"income":"expense";return{...e,type:r}}function Ae(e,n,t){const r=[...n,...t].sort((i,a)=>i.date.localeCompare(a.date)),s=t.find(i=>i.original)?.original,c=(s?.AccountType||s?.accountType||"").toString().trim().toLowerCase()||"checking";return i=>{const a=i.accounts[e],u={accountNumber:e,label:e,type:c,transactions:[]},d=a?{...u,...a,transactions:r}:{...u,transactions:r};return{accounts:{...i.accounts,[e]:d}}}}async function be(e){const n=new TextEncoder().encode(e);if(typeof crypto<"u"&&crypto.subtle){const r=await crypto.subtle.digest("SHA-256",n);return[...new Uint8Array(r)].map(s=>s.toString(16).padStart(2,"0")).join("")}const{createHash:t}=await de(async()=>{const{createHash:r}=await import("./__vite-browser-external-3a0vqkmD.js").then(s=>s._);return{createHash:r}},__vite__mapDeps([0,1,2,3]));return t("sha256").update(n).digest("hex")}async function Re(e,n=16){return(await be(e)).slice(0,n)}const Ee=[/^debitcard\s+\d{3,}:\s*purchase\s*/i,/^pos\s+\d+:?/i,/^web branch:/i,/^ach:/i],Y={netflix:"Subscriptions","prime video":"Entertainment","prime video channels":"Entertainment",hulu:"Subscriptions",spotify:"Subscriptions",rifftrax:"Entertainment","kwik trip":"Gas / Fuel",shell:"Gas / Fuel",chevron:"Gas / Fuel",uber:"Transport",lyft:"Transport",amzn:"Shopping",amazon:"Shopping",walmart:"Shopping",target:"Shopping",rent:"Mortgage / Rent","axiom properties":"Mortgage / Rent",kroger:"Groceries",aldi:"Groceries",costco:"Groceries",starbucks:"Dining",dunkin:"Dining",mcdonald:"Dining"},ve=[{test:/grocer|supermart|super\s?market/i,category:"Groceries"},{test:/fuel|gas\s+station/i,category:"Gas / Fuel"},{test:/pharmacy|walgreens|cvs/i,category:"Health"},{test:/insurance/i,category:"Insurance"}],Te={minOccurrences:3,dominanceRatio:.6},V=me||null;function xe(e){let n=e;return Ee.forEach(t=>{n=n.replace(t,"")}),n.trim()}function J(e){return e.toLowerCase().replace(/\s+/g," ").trim()}function Fe(e,n=3){const t=V?V(e):xe(e);return J(t).split(" ").slice(0,n).join(" ")}function Ge(){return{vendorStats:new Map}}function ke(e,n,t,r){if(!n)return;let s=e.vendorStats.get(n);s||(s={total:0,labeled:0,categoryCounts:new Map},e.vendorStats.set(n,s)),s.total+=1,r&&(s.labeled+=1,s.categoryCounts.set(t,(s.categoryCounts.get(t)||0)+1))}function Ie(e){if(e.category&&!/^uncategorized$/i.test(e.category))return{category:e.category,source:"provided"};const n=J(e.description),t=Object.keys(Y).sort((r,s)=>s.length-r.length);for(const r of t)if(n.includes(r))return{category:Y[r],source:"keyword"};for(const r of ve)if(r.test.test(n))return{category:r.category,source:"regex"};return{category:void 0,source:"none"}}function Me(e,n){const t=Fe(e.description),r=!!(e.category&&!/^uncategorized$/i.test(e.category)),{category:s,source:c}=Ie(e),i=s||(r?e.category:void 0);return ke(n,t,i||e.category,!!i),{...e,category:i,_vendorRoot:t,_catSource:i?c:"none"}}function Ne(e,n,t=Te){for(let r=0;r<e.length;r++){const s=e[r];if(s.category)continue;const c=s._vendorRoot;if(!c)continue;const i=n.vendorStats.get(c);if(!i||i.labeled<t.minOccurrences)continue;let a=null,u=0;for(const[l,m]of i.categoryCounts.entries())m>u&&(u=m,a=l);if(!a)continue;u/i.labeled>=t.dominanceRatio&&(e[r]={...s,category:a,_catSource:"consensus"})}for(let r=0;r<e.length;r++)if(e[r]._vendorRoot){const{_vendorRoot:s,...c}=e[r];e[r]=c}return e}async function Oe({fileText:e,parsedRows:n,accountNumber:t,existingTxns:r,registerManifest:s}){const c=typeof performance<"u"&&performance.now?performance.now():Date.now(),i=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"imp-"+Date.now()+"-"+Math.random().toString(36).slice(2),a=[],u=new Set(r.map(o=>{try{return x(o)}catch{return null}}).filter(Boolean)),d=new Set;let l;n?Array.isArray(n)?l={rows:n,errors:[]}:n.rows?l={rows:n.rows,errors:n.errors||[]}:l={rows:[],errors:[]}:(l=Se(e||""),Array.isArray(l)&&(l={rows:l,errors:[]}));const m=l.rows||[],h=l.errors||[],p=[],g=[];let w=0,C=0;const _={provided:0,keyword:0,regex:0,consensus:0,none:0},F=Ge(),G=500;let D=0;for(const o of h.slice(0,1e3))a.push({type:"parse",message:o.message,line:o.line});let k=0,I=0,M=0,R=0,A=0,N=0,E=0,v=0;const q=typeof performance<"u"&&performance.now?performance.now():Date.now();for(const o of m){const S=typeof performance<"u"&&performance.now?performance.now():Date.now();let f;try{f=_e(o)}catch(y){a.push({type:"normalize",raw:o,message:y?.message||"Normalization error",line:o?.__line});continue}if(!f)continue;f.accountNumber=t;const L=typeof performance<"u"&&performance.now?performance.now():Date.now();k+=L-S;let b;try{b=x(f)}catch(y){a.push({type:"normalize",raw:o,message:"Key build failed: "+(y?.message||"Unknown error"),line:o?.__line});continue}const T=typeof performance<"u"&&performance.now?performance.now():Date.now();R+=T-L;{if(u.has(b)){w++,E++,g.length<10&&g.push({date:f.date,amount:f.rawAmount,desc:f.description,reason:"existing",line:o.__line}),D<G&&(a.push({type:"duplicate",raw:o,message:"Duplicate (existing)",line:o?.__line,reason:"existing"}),D++);const y=typeof performance<"u"&&performance.now?performance.now():Date.now();A+=y-T;continue}if(d.has(b)){C++,v++,g.length<10&&g.push({date:f.date,amount:f.rawAmount,desc:f.description,reason:"intra-file",line:o.__line}),D<G&&(a.push({type:"duplicate",raw:o,message:"Duplicate (intra-file)",line:o?.__line,reason:"intra-file"}),D++);const y=typeof performance<"u"&&performance.now?performance.now():Date.now();A+=y-T;continue}}d.add(b);let ae=typeof performance<"u"&&performance.now?performance.now():Date.now();try{f=De(f)}catch(y){a.push({type:"normalize",raw:o,message:"Classification failed: "+(y?.message||"Unknown error"),line:o?.__line});continue}const U=typeof performance<"u"&&performance.now?performance.now():Date.now();I+=U-ae;try{f=Me(f,F)}catch(y){a.push({type:"normalize",raw:o,message:"Category inference failed: "+(y?.message||"Unknown error"),line:o?.__line});continue}const O=typeof performance<"u"&&performance.now?performance.now():Date.now();M+=O-U;let K;try{K=x(f)}catch(y){a.push({type:"normalize",raw:o,message:"Key build failed: "+(y?.message||"Unknown error"),line:o?.__line});continue}const P=typeof performance<"u"&&performance.now?performance.now():Date.now();R+=P-O;const ce=P,ue=typeof performance<"u"&&performance.now?performance.now():Date.now();A+=ue-ce,p.push({...f,key:K,importSessionId:i,staged:!0,budgetApplied:!1})}const Z=typeof performance<"u"&&performance.now?performance.now():Date.now();Ne(p,F);const ee=typeof performance<"u"&&performance.now?performance.now():Date.now();N+=ee-Z;const ne=+((typeof performance<"u"&&performance.now?performance.now():Date.now())-q).toFixed(2);for(const o of p){const S=o._catSource||"none";_[S]!==void 0?_[S]+=1:_.none+=1}for(let o=0;o<p.length;o++)if(p[o]._catSource){const{_catSource:S,...f}=p[o];p[o]=f}const te=[/internal transfer/i,/xfer to checking/i,/xfer to savings/i,/transfer to checking/i,/transfer to savings/i,/online transfer/i,/xfer .* acct/i];function oe(o=""){return te.some(S=>S.test(o))}const re=p.filter(o=>o.type==="savings").filter(o=>!oe(o.description||"")).map(o=>({id:o.id,originalTxId:o.id,importSessionId:o.importSessionId,date:o.date,month:o.date?.slice(0,7),amount:Math.abs(typeof o.rawAmount=="number"?o.rawAmount:typeof o.amount=="number"?o.amount:Number(o.amount)||0),name:o.description?.slice(0,80)||"Savings Transfer"})),se=Ae(t,r,p),ie=e||(n?JSON.stringify(n.slice(0,1e3)):""),$=await Re(ie);if(s)try{s($,t)}catch{}const z=+((typeof performance<"u"&&performance.now?performance.now():Date.now())-c).toFixed(2);return{patch:se,savingsQueue:re,stats:{newCount:p.length,dupes:w+C,dupesExisting:w,dupesIntraFile:C,hash:$,categorySources:_,importSessionId:i,ingestMs:z,processMs:ne,stageTimings:{normalizeMs:+k.toFixed(2),classifyMs:+I.toFixed(2),inferMs:+M.toFixed(2),keyMs:+R.toFixed(2),dedupeMs:+A.toFixed(2),consensusMs:+N.toFixed(2)},rowsProcessed:m.length,rowsPerSec:m.length?+(m.length/(z/1e3||1)).toFixed(2):0,duplicatesRatio:w+C+p.length?+((w+C)/(w+C+p.length)*100).toFixed(2):0,earlyShortCircuits:{existing:E,intraFile:v,total:E+v}},duplicatesSample:g,acceptedTxns:p.map(o=>({id:o.id,date:o.date,rawAmount:o.rawAmount,amount:o.amount,type:o.type,category:o.category,description:o.description,importSessionId:o.importSessionId})),errors:a,importSessionId:i}}export{ge as S,Se as p,Oe as r};
